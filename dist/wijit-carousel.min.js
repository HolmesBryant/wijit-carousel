/**
 * @author Holmes Bryant <https://github.com/HolmesBryant>
 * @license GPL-3.0
 */
export class WijitCarousel extends HTMLElement{#t=new AbortController;#e;activeindicator="active";#n=!1;#i=!0;#s=!1;#a=["fade","flip","slide","slip"];#r="slide";#o=3;#l=0;#c=1;#d="carda";#h=1;#p=[];firstload=!0;static observedAttributes=["autoplay","clickplay","controls","effect","pause","repeat","speed"];constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`<style>:host {--container-height: 100%;--control-height: 35px;--orientation: column;--overflow: hidden;--panel-height: 100%;--perspective: 1800px;--perspective-origin: center;--speed: ${this.speed}s;--transition-timing: ease;display: block;width: 100%;}.hidden {display: none;}#carda,#cardb {box-sizing: border-box;display: inline-block;height: 100%;left: 0;overflow: var(--overflow);position: relative;vertical-align: top;white-space: wrap;width: 100%;}#container {box-sizing: border-box;display: flex;flex-direction: var(--orientation);grid-template-rows: 1fr var(--control-height);height: var(--container-height);transition: all .5s;}#controls {flex: 0 1 var(--control-height);text-align: center;}#panel {display: block;box-sizing: border-box;flex: 1 0;height: var(--panel-height);margin: 0 auto;opacity: 1;overflow: hidden;position: relative; transform-style: preserve-3d;transition: all var(--speed);transition-timing-function: var(--transition-timing);white-space: nowrap;max-width: auto;perspective: var(--perspective);perspective-origin: var(--perspective-origin);width: 100%;}#panel.fade-out {opacity: 0;}#panel.flipped {overflow: visible;z-index: 1000;}#panel.flipped #carda,#panel.flipped #cardb { backface-visibility: hidden;height: 100%; position: absolute; width: 100%;}#panel.a.flipped #cardb {transform: rotateY(-180deg);}#panel.b.flipped #carda {transform: rotateY(-180deg);}#panel.a.flip #carda {transform: rotateY(180deg);transition: all var(--speed);transition-timing-function: var(--transition-timing);}#panel.a.flip #cardb {transform: rotateY(0deg);transition: all var(--speed);transition-timing-function: var(--transition-timing);}#panel.b.flip #carda {transform: rotateY(0deg);transition: all var(--speed);transition-timing-function: var(--transition-timing);}#panel.b.flip #cardb {transform: rotateY(180deg);transition: all var(--speed);transition-timing-function: var(--transition-timing);}#panel.slide-left #carda,#panel.slide-left #cardb {left: -100%;transition: all var(--speed);transition-timing-function: var(--transition-timing);}#panel.b.slip-left #carda {transition: all var(--speed);transition-timing-function: var(--transition-timing);width: 0%;}#panel.a.slip-left #cardb {transition: all var(--speed);transition-timing-function: var(--transition-timing);width: 0%;}</style><div id="container" part="container"><div id="panel" part="panel"><div id="carda" part="card"><slot name="carda"></slot></div><div id="cardb" part="card"><slot name="cardb"></slot></div></div><div id="controls" part="controls"><slot name="controls"></slot></div></div><div hidden id="slides" class="hidden"><slot id="default-slot"></slot></div>`}attributeChangedCallback(t,e,n){this[t]=n}connectedCallback(){this.shadowRoot.querySelector("#default-slot").addEventListener("slotchange",(t=>{this.firstload&&(this.init(),this.firstload=!1)}))}disconnectedCallback(){this.#t.abort()}init(){this.slides=Array.from(this.children).filter((t=>!t.hasAttribute("slot")));let t=this.querySelectorAll("*[slot=controls]");this.slides&&this.initSlides(this.slides),0===t.length&&(t=this.createControls()),this.#p=this.initControls(t)}initSlides(t){let e=0;for(t[0].setAttribute("slot","carda");e<t.length;e++)t[e].setAttribute("data-slide",e),this.clickplay&&this.addClickAutoListener(t[e]);return t}addClickAutoListener(t){t.addEventListener("click",(t=>{"input"==t.target.localName||"select"==t.target.localName||"textarea"==t.target.localName||"button"==t.target.localName?this.autoplay=!1:this.autoplay=!this.autoplay}),{signal:this.#e.signal})}createControls(){const t=new DocumentFragment,e=document.createElement("input");e.type="radio",e.name="c"+Math.random(),e.setAttribute("slot","controls"),this.slides.forEach(((n,i)=>{const s=e.cloneNode(!0);0===i&&(s.checked=!0),this.controls||s.setAttribute("hidden","true"),t.append(s)}));const n=t.querySelectorAll("input");return n[0].checked=!0,this.append(t),n}initControls(t=this.controls){let e=0;for(t[0].setAttribute(this.activeindicator,"true");e<t.length;e++)t[e].setAttribute("data-target",e),t[e].addEventListener("click",(e=>{this.transition(e);for(const n of t)n.removeAttribute(this.activeindicator),e.target.setAttribute(this.activeindicator,"true")}),{signal:this.#t.signal});return t}transition(t){const e=this.shadowRoot.querySelector("#panel"),n=t.target.getAttribute("data-target"),i=this.querySelector(`[slot='${this.#d}']`),s=this.querySelector(`[data-slide='${n}']`),a="carda"===this.#d?"cardb":"carda";if(i!==s)switch(s.setAttribute("slot",a),this.#d=a,this.effect){case"slip":const t="carda"===this.#d?"a":"b";e.classList.add(t),e.classList.add("slip-left"),this.endEffect(s,["slip-left",t]);break;case"fade":e.classList.add("fade-out"),this.endEffect(s,["fade-out"]);break;case"flip":const n="carda"===this.#d?"b":"a";e.classList.add("flipped"),e.classList.add(n),setTimeout((()=>{e.classList.add("flip")}),5),this.endEffect(s,["flipped",n,"flip"]);break;default:e.classList.add("slide-left"),this.endEffect(s,["slide-left"])}}endEffect(t,e=[]){const n=this.shadowRoot.querySelector("#panel");let i=new AbortController;n.addEventListener("transitionend",(t=>{i.abort(),i=null;const s="carda"===this.#d?"cardb":"carda",a=this.querySelector(`[slot=${s}]`),r=n.querySelector(`#${s}`);a.removeAttribute("slot");for(const t of e)n.classList.remove(t);if(n.append(r),this.enableControls(),this.autoplay){const t=1e3*this.pause;setTimeout((()=>{this.play()}),t)}}),{signal:i.signal}),this.disableControls()}disableControls(t=this.#p){for(const e of t)e.disabled=!0}enableControls(t=this.#p){for(const e of t)e.disabled=!1}play(t=this.#h){if(!this.autoplay)return;const e=this.slides.length*this.repeat,n=t%this.#p.length;console.log(t,n),this.#p[n].click(),this.#h++,0!==e&&t>=e&&(this.autoplay=!1,this.#h=1)}fireEvent(t,e){const n={property:t,value:e},i=new CustomEvent(this.localName,{detail:n});document.dispatchEvent(i)}get autoplay(){return this.#s}set autoplay(t){switch(t){case"false":case!1:this.#s=!1;break;default:this.#s=!0,this.play()}this.fireEvent("autoplay",t)}get clickplay(){return this.#n}set clickplay(t){switch(t){case"false":case!1:t=!1,this.removeAttribute("clickable"),this.#e.abort();break;default:if(t=!0,this.#e=new AbortController,this.slides){this.setAttribute("clickable","true");for(const t of this.slides)this.addClickAutoListener(t)}}this.#n=t,this.fireEvent("clickplay",t)}get controls(){return this.#i}set controls(t){const e=this.shadowRoot.querySelector("#controls");switch(t){case"false":case!1:t=!1,e.setAttribute("hidden","true");break;default:t=!0,e.removeAttribute("hidden")}this.#i=t,this.fireEvent("controls",t)}get effect(){return this.#r}set effect(t){this.#r=t,this.fireEvent("effect",t)}get pause(){return this.#o}set pause(t){t=parseFloat(t),(isNaN(t)||t<0)&&(t=0),this.#o=t,this.fireEvent("pause",t)}get repeat(){return this.#l}set repeat(t){this.#l=t,this.fireEvent("repeat",t)}get speed(){return this.#c}set speed(t){t=parseFloat(t),this.#c=t,this.style.setProperty("--speed",`${t}s`),this.fireEvent("speed",t)}}document.addEventListener("DOMContentLoaded",customElements.define("wijit-carousel",WijitCarousel));
