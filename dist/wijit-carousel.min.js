/**
 * @author Holmes Bryant <https://github.com/HolmesBryant>
 * @license GPL-3.0
 */
export class WijitCarousel extends HTMLElement{#t=new AbortController;#e;activeindicator="active";#n=!1;#i=!1;#s=!1;#a=["fade","flip","slide","slip"];#r="slide";#o=3;#l=0;#c=1;#d="carda";#p=1;#h=[];static observedAttributes=["autoplay","clickplay","controls","effect","pause","repeat","speed"];constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`\n\t\t\t<style>\n\t\t\t\t:host {\n\t\t\t\t\t--container-height: 100%;\n\t\t\t\t\t--control-height: 50px;\n\t\t\t\t\t--overflow: hidden;\n\t\t\t\t\t--panel-height: auto;\n\t\t\t\t\t--perspective: 1800px;\n\t\t\t\t\t--perspective-origin: center;\n\t\t\t\t\t--speed: ${this.speed}s;\n\t\t\t\t\t--transition-timing: ease;\n\t\t\t\t\tdisplay: block;\n\t\t\t\t}\n\n\t\t\t\t.hidden {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\n\t\t\t\t#container {\n\t\t\t\t\tdisplay: grid;\n\t\t\t\t\tgrid-template-rows: 1fr var(--control-height);\n\t\t\t\t\theight: var(--container-height);\n\t\t\t\t\ttransition: all .5s;\n\t\t\t\t}\n\n\t\t\t\t#panel {\n\t\t\t\t\theight: var(--panel-height);\n\t\t\t\t\topacity: 1;\n\t\t\t\t\toverflow: hidden;\n\t\t\t\t\tposition: relative;\n          transform-style: preserve-3d;\n\t\t\t\t\ttransition: all var(--speed);\n\t\t\t\t\ttransition-timing-function: var(--transition-timing);\n\t\t\t\t\twhite-space: nowrap;\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\tperspective: var(--perspective);\n\t\t\t\t\tperspective-origin: var(--perspective-origin);\n\t\t\t\t}\n\n\t\t\t\t#panel.fade-out {\n\t\t\t\t\topacity: 0;\n\t\t\t\t}\n\n\t\t\t\t#panel.flipped {\n\t\t\t\t\toverflow: visible;\n\t\t\t\t\tz-index: 1000;\n\t\t\t\t}\n\n\t\t\t\t#panel.flipped #carda,\n\t\t\t\t#panel.flipped #cardb {\n          backface-visibility: hidden;\n\t\t\t\t\theight: 100%;\n          position: absolute;\n          width: 100%;\n\t\t\t\t}\n\n\t\t\t\t#panel.a.flipped #cardb {\n\t\t\t\t\ttransform: rotateY(-180deg);\n\t\t\t\t}\n\n\t\t\t\t#panel.b.flipped #carda {\n\t\t\t\t\ttransform: rotateY(-180deg);\n\t\t\t\t}\n\n\t\t\t\t#panel.a.flip #carda {\n\t\t\t\t\ttransform: rotateY(180deg);\n\t\t\t\t\ttransition: all var(--speed);\n\t\t\t\t\ttransition-timing-function: var(--transition-timing);\n\t\t\t\t}\n\n\t\t\t\t#panel.a.flip #cardb {\n\t\t\t\t\ttransform: rotateY(0deg);\n\t\t\t\t\ttransition: all var(--speed);\n\t\t\t\t\ttransition-timing-function: var(--transition-timing);\n\t\t\t\t}\n\n\t\t\t\t#panel.b.flip #carda {\n\t\t\t\t\ttransform: rotateY(0deg);\n\t\t\t\t\ttransition: all var(--speed);\n\t\t\t\t\ttransition-timing-function: var(--transition-timing);\n\t\t\t\t}\n\n\t\t\t\t#panel.b.flip #cardb {\n\t\t\t\t\ttransform: rotateY(180deg);\n\t\t\t\t\ttransition: all var(--speed);\n\t\t\t\t\ttransition-timing-function: var(--transition-timing);\n\t\t\t\t}\n\n\t\t\t\t#panel.slide-left #carda,\n\t\t\t\t#panel.slide-left #cardb {\n\t\t\t\t\tleft: -100%;\n\t\t\t\t\ttransition: all var(--speed);\n\t\t\t\t\ttransition-timing-function: var(--transition-timing);\n\t\t\t\t}\n\n\t\t\t\t#panel.b.slip-left #carda {\n\t\t\t\t\ttransition: all var(--speed);\n\t\t\t\t\ttransition-timing-function: var(--transition-timing);\n\t\t\t\t\twidth: 0%;\n\t\t\t\t}\n\n\t\t\t\t#panel.a.slip-left #cardb {\n\t\t\t\t\ttransition: all var(--speed);\n\t\t\t\t\ttransition-timing-function: var(--transition-timing);\n\t\t\t\t\twidth: 0%;\n\t\t\t\t}\n\n\t\t\t\t#carda,\n\t\t\t\t#cardb {\n\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tleft: 0;\n\t\t\t\t\toverflow: var(--overflow);\n\t\t\t\t\tposition: relative;\n\t\t\t\t\ttext-align: center;\n\t\t\t\t\tvertical-align: top;\n\t\t\t\t\twhite-space: wrap;\n\t\t\t\t\twidth: 100%;\n\t\t\t\t}\n\n\t\t\t\t#controls {\n\t\t\t\t\ttext-align: center;\n\t\t\t\t}\n\n\t\t\t\t/* Touch devices */\n\t\t\t\t/*@media (hover: none) {\n\t\t\t\t\t.scroller { overflow-x: auto; }\n\t\t\t\t}*/\n\t\t\t</style>\n\n\t\t\t<div id="container" part="container">\n\t\t\t\t<div id="panel" part="panel">\n\t\t\t\t\t<div id="carda" part="card"><slot name="carda"></slot></div>\n\t\t\t\t\t<div id="cardb" part="card"><slot name="cardb"></slot></div>\n\t\t\t\t</div>\n\t\t\t\t<div id="controls" part="controls">\n\t\t\t\t\t<slot name="controls"></slot>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div hidden id="slides" class="hidden"><slot></slot></div>\n\t\t\t`}attributeChangedCallback(t,e,n){this[t]=n}connectedCallback(){this.slides=Array.from(this.children).filter((t=>!t.hasAttribute("slot")));let t=this.querySelectorAll("*[slot=controls]");this.slides&&this.initSlides(this.slides),0===t.length&&(t=this.createControls()),this.#h=this.initControls(t)}disconnectedCallback(){this.#t.abort()}initSlides(t){let e=0;for(t[0].setAttribute("slot","carda");e<t.length;e++)t[e].setAttribute("data-slide",e),this.clickplay&&this.addClickAutoListener(t[e]);return t}addClickAutoListener(t){t.addEventListener("click",(t=>{"input"==t.target.localName||"select"==t.target.localName||"textarea"==t.target.localName||"button"==t.target.localName?this.autoplay=!1:this.autoplay=!this.autoplay}),{signal:this.#e.signal})}createControls(){const t=new DocumentFragment,e=document.createElement("input");e.type="radio",e.name="c"+Math.random(),e.setAttribute("slot","controls"),this.slides.forEach(((n,i)=>{const s=e.cloneNode(!0);0===i&&(s.checked=!0),this.controls||s.setAttribute("hidden","true"),t.append(s)}));const n=t.querySelectorAll("input");return n[0].checked=!0,this.append(t),n}initControls(t){let e=0;for(t[0].setAttribute(this.activeindicator,"true");e<t.length;e++)t[e].setAttribute("data-target",e),t[e].addEventListener("click",(e=>{this.transition(e);for(const n of t)n.removeAttribute(this.activeindicator),e.target.setAttribute(this.activeindicator,"true")}),{signal:this.#t.signal});return t}transition(t){const e=this.shadowRoot.querySelector("#panel"),n=t.target.getAttribute("data-target"),i=this.querySelector(`[slot='${this.#d}']`),s=this.querySelector(`[data-slide='${n}']`),a="carda"===this.#d?"cardb":"carda";if(i!==s)switch(s.setAttribute("slot",a),this.#d=a,this.effect){case"slip":const t="carda"===this.#d?"a":"b";e.classList.add(t),e.classList.add("slip-left"),this.endEffect(s,["slip-left",t]);break;case"fade":e.classList.add("fade-out"),this.endEffect(s,["fade-out"]);break;case"flip":const n="carda"===this.#d?"b":"a";e.classList.add("flipped"),e.classList.add(n),setTimeout((()=>{e.classList.add("flip")}),5),this.endEffect(s,["flipped",n,"flip"]);break;default:e.classList.add("slide-left"),this.endEffect(s,["slide-left"])}}endEffect(t,e=[]){const n=this.shadowRoot.querySelector("#panel");let i=new AbortController;n.addEventListener("transitionend",(t=>{i.abort(),i=null;const s="carda"===this.#d?"cardb":"carda",a=this.querySelector(`[slot=${s}]`),r=n.querySelector(`#${s}`);a.removeAttribute("slot");for(const t of e)n.classList.remove(t);if(n.append(r),this.enableControls(),this.autoplay){const t=1e3*this.pause;setTimeout((()=>{this.play()}),t)}}),{signal:i.signal}),this.disableControls()}disableControls(t=this.#h){for(const e of t)e.disabled=!0}enableControls(t=this.#h){for(const e of t)e.disabled=!1}play(t=this.#p){if(!this.autoplay)return;const e=this.slides.length*this.repeat,n=t%this.#h.length;console.log(t,n),this.#h[n].click(),this.#p++,0!==e&&t>=e&&(this.autoplay=!1,this.#p=1)}fireEvent(t,e){const n={property:t,value:e},i=new CustomEvent(this.localName,{detail:n});document.dispatchEvent(i)}get autoplay(){return this.#s}set autoplay(t){switch(t){case"false":case!1:this.#s=!1;break;default:this.#s=!0,this.play()}this.fireEvent("autoplay",t)}get clickplay(){return this.#n}set clickplay(t){switch(t){case"false":case!1:t=!1,this.removeAttribute("clickable"),this.#e.abort();break;default:if(t=!0,this.#e=new AbortController,this.slides){this.setAttribute("clickable","true");for(const t of this.slides)this.addClickAutoListener(t)}}this.#n=t,this.fireEvent("clickplay",t)}get controls(){return this.#i}set controls(t){const e=this.shadowRoot.querySelector("#controls");switch(t){case"false":case!1:t=!1,e.setAttribute("hidden","true");break;default:t=!0,e.removeAttribute("hidden")}this.#i=t,this.fireEvent("controls",t)}get effect(){return this.#r}set effect(t){this.#r=t,this.fireEvent("effect",t)}get pause(){return this.#o}set pause(t){t=parseFloat(t),(isNaN(t)||t<0)&&(t=0),this.#o=t,this.fireEvent("pause",t)}get repeat(){return this.#l}set repeat(t){this.#l=t,this.fireEvent("repeat",t)}get speed(){return this.#c}set speed(t){t=parseFloat(t),this.#c=t,this.style.setProperty("--speed",`${t}s`),this.fireEvent("speed",t)}}document.addEventListener("DOMContentLoaded",customElements.define("wijit-carousel",WijitCarousel));
